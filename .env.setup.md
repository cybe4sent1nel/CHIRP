# Environment Variables Setup Guide

Complete guide for setting up all required credentials for Chirp Social Media App

## üìã Overview

The Chirp app uses the following external services:
- **Cloudflare Workers AI** - For AI chatbot features
- **Serper API** - For web search functionality
- **Clerk** - For authentication
- **MongoDB** - For database
- **And more...**

---

## üîß Frontend Setup (client/.env)

```env
# Clerk Authentication
VITE_CLERK_PUBLISHABLE_KEY=<your_clerk_publishable_key>

# API Base URL
VITE_BASEURL=http://localhost:5000

# Cloudflare Workers AI (Optional - for enhanced features)
VITE_CLOUDFLARE_WORKER_URL=https://<your_subdomain>.workers.dev

# Serper API (For web search)
VITE_SERPER_API_KEY=<your_serper_api_key>
```

### How to get Frontend Credentials:

**Clerk Publishable Key:**
1. Go to https://dashboard.clerk.com
2. Select your application
3. Go to "API Keys"
4. Copy the Publishable Key (starts with `pk_`)

**Serper API Key:**
1. Go to https://serper.dev
2. Sign up/login
3. Go to "API Key" in dashboard
4. Copy your API key

---

## üöÄ Backend Setup (server/.env)

```env
# Port Configuration
PORT=5000
NODE_ENV=development

# MongoDB Connection
MONGODB_URI=mongodb+srv://<username>:<password>@<cluster>.mongodb.net/<database>

# Clerk Configuration
CLERK_SECRET_KEY=<your_clerk_secret_key>
CLERK_PUBLISHABLE_KEY=<your_clerk_publishable_key>

# Cloudflare Workers AI
CLOUDFLARE_ACCOUNT_ID=<your_account_id>
CLOUDFLARE_API_TOKEN=<your_api_token>
CLOUDFLARE_WORKER_URL=https://<your_subdomain>.workers.dev

# Serper API (Web Search)
SERPER_API_KEY=<your_serper_api_key>

# JWT Secret (if using custom auth)
JWT_SECRET=<your_jwt_secret_key>

# CORS Configuration
CORS_ORIGIN=http://localhost:5173

# Email Configuration (Optional)
SMTP_HOST=<smtp_host>
SMTP_PORT=<smtp_port>
SMTP_USER=<smtp_user>
SMTP_PASS=<smtp_password>
SMTP_FROM=<sender_email>
```

### How to get Backend Credentials:

**Clerk Secret Key:**
1. Go to https://dashboard.clerk.com
2. Go to "API Keys"
3. Copy the Secret Key (starts with `sk_`)

**Cloudflare Workers AI:**
1. Go to https://dash.cloudflare.com
2. Navigate to "Workers & Pages"
3. Create a new Worker
4. Get your Account ID from the URL: `https://dash.cloudflare.com/<account_id>/workers/...`
5. Create an API Token in "Account Settings" > "API Tokens"
6. Deploy a worker with AI capabilities
7. Copy the Worker URL

**Serper API Key:**
- Same as frontend setup (shared API key)

**MongoDB URI:**
1. Go to https://www.mongodb.com/cloud/atlas
2. Create a cluster
3. Click "Connect"
4. Copy the connection string
5. Replace `<username>`, `<password>`, `<cluster>`, and `<database>`

---

## ü§ñ AI Chatbot Features Configuration

### Using Cloudflare Workers AI

The chatbot uses Cloudflare Workers AI for:
- Post suggestions
- Comment recommendations  
- Hashtag generation
- Web search (via Serper API)

**Setup Steps:**

1. **Create Cloudflare Worker:**
   ```bash
   npm create cloudflare@latest chirp-ai-worker -- --type basic
   ```

2. **Add AI bindings to `wrangler.toml`:**
   ```toml
   [env.production]
   vars = { ENVIRONMENT = "production" }

   [[r2_buckets]]
   binding = "BUCKET"
   bucket_name = "my-bucket"
   jurisdiction = "eu"
   ```

3. **Update Worker code for AI requests:**
   ```javascript
   export default {
     async fetch(request, env) {
       const messages = await request.json();
       
       const response = await env.AI.run("@cf/meta/llama-2-7b-chat-int8", {
         messages: messages,
       });
       
       return new Response(JSON.stringify(response));
     },
   };
   ```

4. **Deploy Worker:**
   ```bash
   npm run deploy
   ```

### Using Serper API for Web Search

The chatbot can browse the web using Serper API:

1. **Sign up at:** https://serper.dev
2. **Get your API key** from the dashboard
3. **API Example:**
   ```bash
   curl "https://google.serper.dev/search" \
     -H "X-API-KEY: $SERPER_API_KEY" \
     -H "Content-Type: application/json" \
     -d '{"q": "latest AI trends"}'
   ```

---

## üíæ Chat Memory & Context

The chatbot maintains conversation history using:
- **Browser LocalStorage** - For client-side session memory
- **MongoDB** - For persistent chat history
- **Context Window** - Maintains up to 10 previous messages for context

**Database Schema:**
```javascript
{
  _id: ObjectId,
  userId: String,
  username: String,
  timestamp: Date,
  messages: [
    {
      role: "user" | "assistant",
      content: String,
      timestamp: Date
    }
  ],
  metadata: {
    totalTokens: Number,
    suggestions: {
      posts: Number,
      comments: Number,
      hashtags: Number,
      webSearches: Number
    }
  }
}
```

---

## üì± Profile QR Code Features

The Profile QR section encodes:
- User profile URL: `{baseURL}/profile/{username}`
- Can be customized with:
  - Foreground color (QR code color)
  - Background color
  - Pattern styles (from `/public/qrpatterns`)
  - Chirp logo overlay in center

**Supported Patterns:**
- square, round, rounded-in, pointed, leaf
- diamond, dot, circle, star

All patterns are stored in: `public/qrpatterns/`

---

## üîê Security Notes

1. **Never commit .env files** - Add to `.gitignore`
2. **Use strong JWT secrets** - Generate with: `node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"`
3. **Rotate API keys** regularly
4. **Use HTTPS** in production
5. **Enable CORS** only for your domains
6. **Validate all inputs** server-side

---

## üöÄ Running the Application

### Option 1: Using unified start script
```bash
# Windows (CMD)
start.bat

# Windows (PowerShell)
start.ps1

# Mac/Linux
node start.js

# Or use npm
npm start
```

### Option 2: Manual startup
```bash
# Terminal 1 - Backend
cd server
npm run dev

# Terminal 2 - Frontend
cd client
npm run dev
```

---

## üìù Checklist

- [ ] Frontend `.env` configured with VITE_ variables
- [ ] Backend `.env` configured with server variables
- [ ] Clerk authentication keys added
- [ ] MongoDB connection string added
- [ ] Cloudflare Workers AI setup (optional)
- [ ] Serper API key added
- [ ] CORS origins updated
- [ ] All `.env` files added to `.gitignore`
- [ ] Run `npm install:all` to install all dependencies

---

## ‚ùì Troubleshooting

**"Clerk authentication not working"**
- Verify PUBLISHABLE_KEY and SECRET_KEY
- Check CORS_ORIGIN in backend matches frontend URL

**"AI Chatbot not responding"**
- Check CLOUDFLARE_WORKER_URL is correct
- Verify CLOUDFLARE_API_TOKEN is valid
- Check Cloudflare account limits

**"QR Code not generating"**
- Verify qrcode.react package is installed: `npm install qrcode.react`
- Check browser console for errors

**"Web search not working"**
- Verify SERPER_API_KEY is valid
- Check daily request limits on Serper

---

## üìö Additional Resources

- [Clerk Docs](https://clerk.com/docs)
- [Cloudflare Workers AI](https://developers.cloudflare.com/workers-ai/)
- [Serper API Docs](https://serper.dev/docs)
- [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
- [QR Code React](https://www.npmjs.com/package/qrcode.react)

---

**Last Updated:** December 2025
**Version:** 1.0.0
